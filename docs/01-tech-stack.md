# Технологический стек

## Backend
- **Node.js** v20+ — серверное окружение
- **Telegraf** v4.16+ — фреймворк для Telegram Bot API
- **sql.js** v1.11+ — SQLite в памяти (без нативной компиляции)

## AI / ML
- **gpt-4o-mini** через GitHub Models — генеративная модель (высокие лимиты)
- **OpenAI SDK** v4.70+ — клиент для GitHub Models API

## Утилиты
- **node-schedule** v2.1+ — планировщик задач (cron)
- **dotenv** v16.4+ — переменные окружения

## НЕ используется
❌ TypeScript (только vanilla JS + JSDoc при необходимости)  
❌ Фреймворки (Express, Koa, Fastify)  
❌ ORM (Prisma, Sequelize, TypeORM)  
❌ Тестовые фреймворки (пока MVP)  
❌ Линтеры/форматтеры (ESLint, Prettier — добавятся позже)  
❌ Сборщики (Webpack, Vite — не нужны для бота)  
❌ Docker, PM2 (запуск через `npm start`)

## Структура проекта
```
samoyed_bot/
├── src/
│   ├── index.js           # Точка входа, логика бота
│   ├── database.js        # Работа с SQLite
│   ├── training.js        # Данные: задания, база знаний, SOS
│   ├── deepseek.js        # AI-интеграция
│   └── scheduler.js       # Планировщик утренних советов
├── data/
│   └── bot.db             # SQLite база (создаётся автоматически)
├── docs/
│   ├── 00-ai-contract.md  # Контракт с AI
│   ├── 01-tech-stack.md   # Этот файл
│   ├── 02-user-stories.md # Сценарии использования
│   └── 04-architecture.md # Описание архитектуры
├── .env                   # Секреты (не в git)
├── .env.example           # Шаблон .env
├── .gitignore
├── package.json
├── config.js              # Конфигурация приложения
├── gemini.md              # Правила работы с AI
└── README.md              # Документация для пользователя
```

## Почему такой стек?

**Node.js + ES Modules:**
- Простота для MVP
- Нативная поддержка async/await
- Большая экосистема для Telegram

**Telegraf:**
- Лучший фреймворк для Telegram на Node.js
- Удобный API для кнопок и меню
- Хорошая документация на русском

**sql.js (не better-sqlite3):**
- Избегает проблем с нативной компиляцией в Windows
- Работает из коробки
- Достаточно для MVP (до 1000 пользователей)

**DeepSeek через GitHub Models:**
- Бесплатный доступ для тестирования
- OpenAI-совместимый API
- Работает из России
- Хорошее качество ответов

## Ограничения

**Масштабирование:**
- sql.js в памяти — не для highload
- Одна инстанция бота — нет кластеризации
- Нет rate limiting на AI (полагается на лимиты API)

**Когда менять стек:**
- \>1000 активных пользователей → переход на PostgreSQL
- \>10000 сообщений/день → добавить Redis для кеша
- Нужна отказоустойчивость → Docker + PM2

## Команды разработки

```powershell
# Установка зависимостей
npm install

# Запуск бота
npm start

# Проверка синтаксиса
node --check src/index.js
```

## Добавление новых зависимостей

**ВСЕГДА спрашивать разрешения перед:**
```powershell
npm install новый-пакет
```

**Обосновать:**
- Зачем нужен пакет?
- Какую проблему решает?
- Есть ли альтернативы?
- Размер пакета и количество зависимостей?
