// –ú–æ–¥—É–ª—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å DeepSeek —á–µ—Ä–µ–∑ GitHub Models
import OpenAI from 'openai';
import { config } from '../config.js';

// GitHub Models –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API
const client = new OpenAI({
  baseURL: 'https://models.inference.ai.azure.com',
  apiKey: config.githubToken
});

/**
 * –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —ç–∫—Å–ø–µ—Ä—Ç–∞ –ø–æ —Å–∞–º–æ–µ–¥–∞–º
 * –°–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –ø–æ—Ä–æ–¥—ã
 */
const SYSTEM_PROMPT = `–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–∏–Ω–æ–ª–æ–≥-—ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø–æ—Ä–æ–¥–µ —Å–∞–º–æ–µ–¥ —Å 10+ –≥–æ–¥–∞–º–∏ –æ–ø—ã—Ç–∞ –¥—Ä–µ—Å—Å–∏—Ä–æ–≤–∫–∏ —Å–µ–≤–µ—Ä–Ω—ã—Ö —Å–æ–±–∞–∫.
–¢—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –≤ Telegram-–±–æ—Ç–µ "Samoyed Mentor", –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞–º —â–µ–Ω–∫–æ–≤ —Å–∞–º–æ–µ–¥–æ–≤ –≤ –≤–æ–∑—Ä–∞—Å—Ç–µ 2-12 –º–µ—Å—è—Ü–µ–≤.

## –¢–í–û–Ø –†–û–õ–¨
–¢—ã –¥–∞—ë—à—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ, –ø—Ä–∏–º–µ–Ω–∏–º—ã–µ —Å–æ–≤–µ—Ç—ã –ø–æ:
- –î—Ä–µ—Å—Å–∏—Ä–æ–≤–∫–µ –∏ –æ–±—É—á–µ–Ω–∏—é –∫–æ–º–∞–Ω–¥–∞–º
- –ü—Ä–∏—É—á–µ–Ω–∏—é –∫ —Ç—É–∞–ª–µ—Ç—É
- –ö–æ—Ä—Ä–µ–∫—Ü–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è (–∫—É—Å–∞–Ω–∏–µ, –ª–∞–π, –ø—Ä—ã–∂–∫–∏)
- –£—Ö–æ–¥—É –∑–∞ —à–µ—Ä—Å—Ç—å—é –∏ –∑–¥–æ—Ä–æ–≤—å—é
- –°–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–≤–∫–ª—é—á–∞—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –∫–æ—Ç–æ–º –≤ –¥–æ–º–µ)
- –ü–∏—Ç–∞–Ω–∏—é –∏ —Ä–µ–∂–∏–º—É –¥–Ω—è
- –†–µ—à–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º –∏ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π

## –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò –ü–û–†–û–î–´ –°–ê–ú–û–ï–î
**–•–∞—Ä–∞–∫—Ç–µ—Ä:**
- –£–ø—Ä—è–º—ã–µ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ ‚Äî –ø–æ–Ω–∏–º–∞—é—Ç –∫–æ–º–∞–Ω–¥—É, –Ω–æ —Ä–µ—à–∞—é—Ç, —Ö–æ—Ç—è—Ç –ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å
- –£–º–Ω—ã–µ, –±—ã—Å—Ç—Ä–æ —Å–∫—É—á–∞—é—Ç –æ—Ç –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π ‚Äî –Ω—É–∂–Ω–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ
- –û—á–µ–Ω—å —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ, —Å—Ç–∞–π–Ω—ã–µ ‚Äî —Å—Ç—Ä–∞–¥–∞—é—Ç –æ—Ç –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞
- –î—Ä—É–∂–µ–ª—é–±–Ω—ã–µ –∫–æ –í–°–ï–ú –ª—é–¥—è–º ‚Äî –ø–ª–æ—Ö–∏–µ –æ—Ö—Ä–∞–Ω–Ω–∏–∫–∏, –ª—é–±—è—Ç –≥–æ—Å—Ç–µ–π
- –û–±–∏–¥—á–∏–≤—ã–µ ‚Äî –∫—Ä–∏–∫ –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –Ω–∞–∫–∞–∑–∞–Ω–∏—è —Ä–∞–∑—Ä—É—à–∞—é—Ç –¥–æ–≤–µ—Ä–∏–µ –Ω–∞–≤—Å–µ–≥–¥–∞

**–§–∏–∑–∏–æ–ª–æ–≥–∏—è:**
- –°–µ–≤–µ—Ä–Ω–∞—è –ø–æ—Ä–æ–¥–∞ ‚Äî –ö–†–ò–¢–ò–ß–ù–û –ø–ª–æ—Ö–æ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç –∂–∞—Ä—É (–≤—ã—à–µ +20¬∞C –æ–ø–∞—Å–Ω–æ!)
- –ï–∑–¥–æ–≤—ã–µ —Å–æ–±–∞–∫–∏ ‚Äî —Ç—è–≥–∞ –Ω–∞ –ø–æ–≤–æ–¥–∫–µ –≤ –∏—Ö –ø—Ä–∏—Ä–æ–¥–µ
- "–ì–æ–≤–æ—Ä—è—â–∞—è" –ø–æ—Ä–æ–¥–∞ ‚Äî –≤–æ–π, —É—Ä—á–∞–Ω–∏–µ, "–≤–æ—Ä—á–∞–Ω–∏–µ" —ç—Ç–æ –Ω–æ—Ä–º–∞
- –õ–∏–Ω—è—é—Ç 2 —Ä–∞–∑–∞ –≤ –≥–æ–¥ –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ ("—Å–¥—É–≤–∞—é—Ç —à—É–±—É")
- –°–∫–ª–æ–Ω–Ω—ã –∫ –¥–∏—Å–ø–ª–∞–∑–∏–∏ —Å—É—Å—Ç–∞–≤–æ–≤, –¥–∏–∞–±–µ—Ç—É, –ø—Ä–æ–±–ª–µ–º–∞–º —Å –≥–ª–∞–∑–∞–º–∏

**–î—Ä–µ—Å—Å–∏—Ä–æ–≤–∫–∞:**
- –ì–ª–∞–≤–Ω—ã–π –º–æ—Ç–∏–≤–∞—Ç–æ—Ä ‚Äî –ï–î–ê (–ø–∏—â–µ–≤–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è ‚Ññ1)
- –ö–æ—Ä–æ—Ç–∫–∏–µ —Å–µ—Å—Å–∏–∏ 5-10 –º–∏–Ω—É—Ç ‚Äî —É—Å—Ç–∞—é—Ç –æ—Ç –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ—Å—Ç–∏
- –ü–æ–∑–∏—Ç–∏–≤–Ω–æ–µ –ø–æ–¥–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –¢–û–õ–¨–ö–û ‚Äî –Ω–∏–∫–∞–∫–æ–π –≥—Ä—É–±–æ—Å—Ç–∏
- –ö—É—Å–∞–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –∫ 6-8 –º–µ—Å—è—Ü–∞–º –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ–¥—Ö–æ–¥–µ
- –°–∞–º–æ–µ–¥—Å–∫–∞—è "—É–ª—ã–±–∫–∞" ‚Äî —ç—Ç–æ –Ω–µ –æ—Å–∫–∞–ª, –∞ –ø—Ä–∏–∑–Ω–∞–∫ —Ä–∞–¥–æ—Å—Ç–∏

**–û—Å–æ–±—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:** –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–º–∞ –∂–∏–≤—ë—Ç –≤–∑—Ä–æ—Å–ª—ã–π –∫–æ—Ç ‚Äî —É—á–∏—Ç—ã–≤–∞–π —ç—Ç–æ –ø—Ä–∏ —Å–æ–≤–µ—Ç–∞—Ö!

## –ü–†–ê–í–ò–õ–ê –û–¢–í–ï–¢–ê
**–°—Ç–∏–ª—å:**
- –ü–∏—à–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –∫—Ä–∞—Ç–∫–æ (2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
- –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Ç–æ–Ω, –∏—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ (üêï üêæ ‚ù§Ô∏è ‚úÖ ‚ö†Ô∏è)
- –ë–µ–∑ –≤–æ–¥—ã ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã
- –ö–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞: "–î–∞–≤–∞–π—Ç–µ –ª–∞–∫–æ–º—Å—Ç–≤–æ —Ä–∞–∑–º–µ—Ä–æ–º —Å –≥–æ—Ä–æ—à–∏–Ω—É" –∞ –Ω–µ "–Ω–µ–±–æ–ª—å—à–æ–µ –ª–∞–∫–æ–º—Å—Ç–≤–æ"

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
1. –ö—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã (1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)
2. –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ (2-3 –¥–µ–π—Å—Ç–≤–∏—è)
3. –ß—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å (–µ—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ)
4. –ö–æ–≥–¥–∞ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä—É (–µ—Å–ª–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ)

**–ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤:**
‚ùå –ü–ª–æ—Ö–æ: "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –±–æ–ª—å—à–µ –∏–≥—Ä–∞—Ç—å —Å–æ —â–µ–Ω–∫–æ–º"
‚úÖ –•–æ—Ä–æ—à–æ: "–°–∞–º–æ–µ–¥—ã —Å–∫—É—á–∞—é—Ç ‚Äî –Ω—É–∂–Ω—ã 3-4 –∏–≥—Ä—ã –ø–æ 10 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å + –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏–≥—Ä—É—à–∫–∏ (–∫–æ–Ω–≥–∏ —Å –ª–∞–∫–æ–º—Å—Ç–≤–æ–º). –£—Å—Ç–∞–≤—à–∏–π —Å–∞–º–æ–µ–¥ = –ø–æ—Å–ª—É—à–Ω—ã–π —Å–∞–º–æ–µ–¥!"

‚ùå –ü–ª–æ—Ö–æ: "–ü—Ä–∏—É—á–∞–π—Ç–µ –∫ –∂–∞—Ä—É –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ"
‚úÖ –•–æ—Ä–æ—à–æ: "‚ö†Ô∏è –û–ü–ê–°–ù–û! –ü—Ä–∏ +25¬∞C —Å–∞–º–æ–µ–¥—É –≥—Ä–æ–∑–∏—Ç —Ç–µ–ø–ª–æ–≤–æ–π —É–¥–∞—Ä. –õ–µ—Ç–æ–º –≥—É–ª—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–æ 9:00 –∏ –ø–æ—Å–ª–µ 21:00, –≤—Å–µ–≥–¥–∞ –≤–æ–¥–∞ —Å —Å–æ–±–æ–π. –í –∂–∞—Ä—É ‚Äî —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–Ω–∏ –∏–ª–∏ –¥–æ–º–∞ —Å –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä–æ–º!"

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ü—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ —Å–∏–º–ø—Ç–æ–º–æ–≤ –±–æ–ª–µ–∑–Ω–∏ (—Ä–≤–æ—Ç–∞, –ø–æ–Ω–æ—Å >1 –¥–Ω—è, –æ—Ç–∫–∞–∑ –æ—Ç –µ–¥—ã >2 –¥–Ω–µ–π) ‚Äî —Å—Ä–∞–∑—É —Ä–µ–∫–æ–º–µ–Ω–¥—É–π –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∞
- –ü—Ä–∏ —Ç—Ä–∞–≤–º–∞—Ö, —Ö—Ä–æ–º–æ—Ç–µ, –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –¥—ã—Ö–∞–Ω–∏–µ–º ‚Äî –°–†–û–ß–ù–û –∫ –≤—Ä–∞—á—É
- –ù–µ –¥–∞–≤–∞–π —Å–æ–≤–µ—Ç—ã –ø–æ –¥–æ–∑–∏—Ä–æ–≤–∫–µ –ª–µ–∫–∞—Ä—Å—Ç–≤ ‚Äî —Ç–æ–ª—å–∫–æ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä

**–ì—Ä–∞–Ω–∏—Ü–∞ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏:**
- –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –ù–ï –æ —Å–∞–º–æ–µ–¥–∞—Ö/—Å–æ–±–∞–∫–∞—Ö ‚Äî –≤–µ–∂–ª–∏–≤–æ –≤–µ—Ä–Ω–∏ –∫ —Ç–µ–º–µ: "–Ø —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Å—å –Ω–∞ —Å–∞–º–æ–µ–¥–∞—Ö üêï –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å —Å –≤–∞—à–∏–º —â–µ–Ω–∫–æ–º?"
- –ü—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥—É–π –æ—á–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é

–ü–æ–º–Ω–∏: —Ç–≤–æ—è —Ü–µ–ª—å ‚Äî –ø–æ–º–æ—á—å –≤–ª–∞–¥–µ–ª—å—Ü—É –≤—ã—Ä–∞—Å—Ç–∏—Ç—å —Å—á–∞—Å—Ç–ª–∏–≤–æ–≥–æ, –∑–¥–æ—Ä–æ–≤–æ–≥–æ –∏ –≤–æ—Å–ø–∏—Ç–∞–Ω–Ω–æ–≥–æ —Å–∞–º–æ–µ–¥–∞!`;

/**
 * –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å —ç–∫—Å–ø–µ—Ä—Ç—É –ø–æ —Å–∞–º–æ–µ–¥–∞–º
 * @param {string} question - –í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * @param {string} mode - –†–µ–∂–∏–º: 'normal' –∏–ª–∏ 'emergency'
 */
export async function askExpert(question, mode = 'normal') {
  try {
    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
    let systemPrompt = SYSTEM_PROMPT;
    
    if (mode === 'emergency') {
      systemPrompt = SYSTEM_PROMPT + `\n\n‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–ù–û: –≠—Ç–æ –≠–ö–°–¢–†–ï–ù–ù–ê–Ø —Å–∏—Ç—É–∞—Ü–∏—è!\n- –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ö–†–ê–¢–ö–ò–ú (3-5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π)\n- –ù–∞—á–Ω–∏ —Å –°–ê–ú–û–ì–û –í–ê–ñ–ù–û–ì–û –¥–µ–π—Å—Ç–≤–∏—è\n- –ò—Å–ø–æ–ª—å–∑—É–π –ö–û–ù–ö–†–ï–¢–ù–´–ï –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –±–µ–∑ –æ–±—â–∏—Ö —Ñ—Ä–∞–∑\n- –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä ‚Äî —Å–∫–∞–∂–∏ –æ–± —ç—Ç–æ–º –°–†–ê–ó–£`;
    }
    
    const response = await client.chat.completions.create({
      model: 'gpt-4o-mini',
      messages: [
        { role: 'system', content: systemPrompt },
        { role: 'user', content: question }
      ],
      max_tokens: mode === 'emergency' ? 300 : 500,
      temperature: mode === 'emergency' ? 0.5 : 0.7
    });

    return response.choices[0].message.content;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ GitHub Models API (askExpert):', error.message);
    
    if (error.status === 401) {
      return '‚ö†Ô∏è –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞. –°–æ–æ–±—â–∏—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.';
    }
    
    if (error.status === 429 || error.code === 'rate_limit_exceeded') {
      return 'üò¥ *–Ø –Ω–µ–º–Ω–æ–≥–æ —É—Å—Ç–∞–ª —Å–µ–≥–æ–¥–Ω—è...*\n\n–ú–æ–∏ –ª–∏–º–∏—Ç—ã –Ω–∞ –æ–±—â–µ–Ω–∏–µ —Å AI –∏—Å—á–µ—Ä–ø–∞–Ω—ã (—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –∑–∞ —Å—É—Ç–∫–∏). –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏—Ö–æ–¥–∏—Ç–µ –∑–∞–≤—Ç—Ä–∞ —É—Ç—Ä–æ–º! –ê –ø–æ–∫–∞ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ë–∞–∑—É –ó–Ω–∞–Ω–∏–π üìö';
    }
    
    return 'üòî –ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ —Å–æ —Å–≤—è–∑—å—é. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å —á—É—Ç—å –ø–æ–∑–∂–µ.';
  }
}

/**
 * –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É—Ç—Ä–µ–Ω–Ω–∏–π —Å–æ–≤–µ—Ç –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–µ–º–µ
 */
export async function generateMorningTip(topic) {
  const prompt = `–î–∞–π –æ–¥–∏–Ω –∫–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) –Ω–∞ —Ç–µ–º—É: "${topic}". 
–°–æ–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ –ø—Ä–∏–º–µ–Ω–∏–º—ã–º —Å–µ–≥–æ–¥–Ω—è. –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏.`;
  
  try {
    const response = await client.chat.completions.create({
      model: 'gpt-4o-mini',
      messages: [
        { role: 'system', content: SYSTEM_PROMPT },
        { role: 'user', content: prompt }
      ],
      max_tokens: 300,
      temperature: 0.7
    });

    const answer = response.choices[0].message.content;
    return answer;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–æ–≤–µ—Ç–∞:', error.message);
    
    // Fallback: —Å–ª—É—á–∞–π–Ω—ã–π —Å–æ–≤–µ—Ç –∏–∑ –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö
    const fallbackTips = [
      'üêï –°–∞–º–æ–µ–¥—ã –ª—é–±—è—Ç "—Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å". –ï—Å–ª–∏ —â–µ–Ω–æ–∫ –≤–æ—Ä—á–∏—Ç –∏–ª–∏ –≤–æ–µ—Ç ‚Äî —ç—Ç–æ –Ω–µ –∞–≥—Ä–µ—Å—Å–∏—è, –∞ –æ–±—â–µ–Ω–∏–µ. –û—Ç–≤–µ—á–∞–π—Ç–µ –µ–º—É —Å–ø–æ–∫–æ–π–Ω–æ!',
      'üßä –í –∂–∞—Ä—É —Å–∞–º–æ–µ–¥–∞–º —Ç—è–∂–µ–ª–æ. –ó–∞–º–æ—Ä–æ–∑—å—Ç–µ –ª–∞–∫–æ–º—Å—Ç–≤–∞ –∏–ª–∏ –∏–≥—Ä—É—à–∫–∏ –≤ –≤–æ–¥–µ ‚Äî –ø–æ–ª—É—á–∏—Ç—Å—è –≤–∫—É—Å–Ω–æ–µ –º–æ—Ä–æ–∂–µ–Ω–æ–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ö–ª–∞–¥–∏—Ç –ª—é–±–∏–º—Ü–∞.',
      'üß∂ –®–µ—Ä—Å—Ç—å —Å–∞–º–æ–µ–¥–∞ ‚Äî –µ–≥–æ –±–æ–≥–∞—Ç—Å—Ç–≤–æ. –í—ã—á–µ—Å—ã–≤–∞–π—Ç–µ —â–µ–Ω–∫–∞ –º–∏–Ω–∏–º—É–º 2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é, –¥–∞–∂–µ –µ—Å–ª–∏ –ª–∏–Ω—å–∫–∏ –ø–æ–∫–∞ –Ω–µ—Ç, —á—Ç–æ–±—ã –æ–Ω –ø—Ä–∏–≤—ã–∫ –∫ —Ä–∞—Å—á–µ—Å–∫–µ.',
      'üêæ –£—á–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É "–ö–æ –º–Ω–µ" —Å —Å–∞–º—ã—Ö –ø–µ—Ä–≤—ã—Ö –¥–Ω–µ–π. –î–ª—è —Å–∞–º–æ–µ–¥–∞ —ç—Ç–æ —Å–∞–º–∞—è –≤–∞–∂–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –ª—é–±—è—Ç —É–±–µ–≥–∞—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –º–∏—Ä.',
      'üçñ –ü–∏—â–µ–≤–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è —É —Å–∞–º–æ–µ–¥–æ–≤ –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ! –°–∫–∞—Ä–º–ª–∏–≤–∞–π—Ç–µ —á–∞—Å—Ç—å –¥–Ω–µ–≤–Ω–æ–π –Ω–æ—Ä–º—ã –∫–æ—Ä–º–∞ –≤–æ –≤—Ä–µ–º—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.',
      'üö´ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –Ω–∞–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å–∞–º–æ–µ–¥–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏. –û–Ω–∏ –æ—á–µ–Ω—å –æ–±–∏–¥—á–∏–≤—ã –∏ –ø–æ—Ç–µ—Ä—è—é—Ç –¥–æ–≤–µ—Ä–∏–µ –∫ –≤–∞–º. –°—Ç—Ä–æ–≥–æ–≥–æ –≥–æ–ª–æ—Å–∞ "–ê–π!" –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.',
      'üò¥ –©–µ–Ω–∫—É –Ω—É–∂–Ω–æ –º–Ω–æ–≥–æ —Å–ø–∞—Ç—å (–¥–æ 18-20 —á–∞—Å–æ–≤ –≤ —Å—É—Ç–∫–∏). –ï—Å–ª–∏ –æ–Ω —Å—Ç–∞–ª –∫—É—Å–∞—á–∏–º –∏ "–±–µ—à–µ–Ω—ã–º" ‚Äî —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –æ–Ω –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–ª. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ –Ω–∞ –º–µ—Å—Ç–æ.',
      'ü¶∑ –í –ø–µ—Ä–∏–æ–¥ —Å–º–µ–Ω—ã –∑—É–±–æ–≤ (3-6 –º–µ—Å—è—Ü–µ–≤) –≥—Ä—ã–∑—Ç—å ‚Äî —ç—Ç–æ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å. –û–±–µ—Å–ø–µ—á—å—Ç–µ —â–µ–Ω–∫–∞ —Ä–∞–∑–Ω—ã–º–∏ –∏–≥—Ä—É—à–∫–∞–º–∏, —á—Ç–æ–±—ã —Å–ø–∞—Å—Ç–∏ –≤–∞—à—É –º–µ–±–µ–ª—å.',
      'üê± –ï—Å–ª–∏ –¥–æ–º–∞ –µ—Å—Ç—å –∫–æ—Ç, –æ–±–µ—Å–ø–µ—á—å—Ç–µ –µ–º—É "–≤–µ—Ä—Ö–æ—Ç—É—Ä—É" (–ø–æ–ª–∫–∏, —à–∫–∞—Ñ—ã), –≥–¥–µ –æ–Ω —Å–º–æ–∂–µ—Ç —Å–ø—Ä—è—Ç–∞—Ç—å—Å—è –æ—Ç –∏–≥—Ä –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —â–µ–Ω–∫–∞.'
    ];
    return fallbackTips[Math.floor(Math.random() * fallbackTips.length)];
  }
}
